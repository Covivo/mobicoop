{# @var community \Mobicoop\Bundle\MobicoopBundle\Community\Entity\Community #}
{% extends '@Mobicoop/base.html.twig' %}

{% block title %}CommunautÃ©
{% endblock %}
{% block stylesheets %}
    {{ encore_entry_link_tags("#{assets_prefix ?? ''}community/showCommunity") }}
{% endblock %}
{% block main %}
    {# @var community \Mobicoop\Bundle\MobicoopBundle\Community\Entity\Community#}
    {% set paths= [] %}
    {% set lastusers= [] %}

{# get all community users + log user #}
    {# {% for cuser in community.communityUsers %} #}
        {# @var user \App\User\Entity\User #}
        {# {% set user= cuser.user %}
        {% set users = users|merge([user]) %}
    {% endfor %} #}

    {% set defaultPreviewCommunity = 'https://picsum.photos/id/237/600/300' %}
    {% set paths = paths|merge({'community_images':community.images.first |default(defaultPreviewCommunity)}) %}

{# filters the last users #}
    {% set clastusers = community.communityUsers
        |sort((communityUsera, communityUserb) => ((communityUserb.createdDate < communityUsera.createdDate)? -1 :(communityUserb.createdDate < communityUsera.createdDate) ? 0 : 1 ))
        |slice(0,3) %}
   
    {% for cuser in clastusers %}
        {# @var user \App\User\Entity\User #}
        {% set user= cuser.user %}
        {% set data = [{'avatar':'-', 'name': user.givenName ~ ' ' ~ user.familyName, 'acceptedDate': cuser.createdDate | date("d/m/Y") }] %}

        {% set lastusers = lastusers|merge(data) %}
    {% endfor %}

        <community-display
                :community="{{ community|json_encode }}" 
                :users="{{ users|json_encode }}"
                :paths="{{ paths|json_encode }}"
                :geodata="{{ {'geocompleteuri':geoCompleteUri,  'searchroute':searchRoute}|json_encode }}"
                :user="{{app.user|json_encode}}"
                :sign-up-users= "{{ lastusers|json_encode }}"
        ></community-display>

{% endblock %}
{% block javascripts %}
    {{ encore_entry_script_tags("#{assets_prefix ?? ''}community/showCommunity") }}
{% endblock %}
